---
title: "P8105_hw6_ja3314"
author: "Jaisal Amin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

```{r, message = FALSE, warning = FALSE}
url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"
raw_data = read_csv(url) %>% 
  mutate(city_state = str_c(city, ",", " ", state)) %>% 
  mutate(resolved = as.numeric(disposition == "Closed by arrest"),
         victim_age = as.numeric(victim_age),
         victim_race = ifelse(victim_race == "White", c("White"), c("Non-white")),
         victim_race = fct_relevel(victim_race, "White")) %>% 
  filter(!city_state %in% c("Tulsa, AL", "Dallas, TX", "Phoenix, AZ", "Kansas City, MO"))

```


```{r}
baltimore_df = 
  raw_data %>% 
  filter(city_state == "Baltimore, MD") %>% 
  select(resolved, victim_age, victim_race, victim_sex)

fit_logistic = 
  baltimore_df %>% 
  glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())

fit_logistic %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         OR_upper_bound = exp(estimate + 1.96*std.error),
         OR_lower_bound = exp(estimate - 1.96*std.error)) %>%
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

```{r}
city_glm = 
  raw_data %>% 
  group_by(city_state) %>% 
  nest() %>% 
  mutate(models = map(data, ~glm(resolved ~ victim_age + victim_race + victim_sex, data = ., family = binomial())),
         models = map(models, broom::tidy)) %>% 
  select(-data) %>%
  unnest() %>% 
  mutate(OR = exp(estimate),
         OR_upper_bound = exp(estimate + 1.96*std.error),
         OR_lower_bound = exp(estimate - 1.96*std.error)) %>% 
  select(term, log_OR = estimate, OR, p.value) %>% 
  knitr::kable(digits = 3)
```

```{r}
birthweight_df = read_csv("./data/birthweight.csv")
  
```



